<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Search with Suggestions</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .search-container {
            margin: 20px 0;
            position: relative;
        }
        input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .suggestions {
            border: 1px solid #ccc;
            max-height: 200px;
            overflow-y: auto;
            position: absolute;
            background-color: white;
            z-index: 1000;
            width: 100%;
            display: none;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .suggestions div {
            padding: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .suggestions div:hover {
            background-color: #e9e9e9;
        }
        .result-card {
            max-width: 600px;
            margin-top: 10px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: #e3f2fd;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            animation: fadeIn 0.5s; /* Animation for result cards */
        }
        .result-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            border-bottom: 1px solid #504b4b45;
            padding-bottom: 10px;
            align-items: center;
        }
        .result-header {
            font-weight: bold;
            color: #007bff;
            width: 30%;
        }
        .result-content {
            width: 70%;
            display: flex;
            align-items: center;
            flex-direction: column; /* Column layout for content */
        }
        img {
            max-width: 100%; /* Make images responsive */
            height: auto; /* Maintain aspect ratio */
            margin-right: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            width: 100%; /* Set image width to full */
        }
        .icons {
            display: flex;
            justify-content: space-around; /* Space between icons */
            margin-top: 10px;
        }
        .icon {
            width: 100px; /* Set icon size */
            height: 24px;
            cursor: pointer; /* Change cursor to pointer */
        }
        a {
            color: #007bff;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .error {
            color: red;
            margin-top: 5px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>

    <h1>CSV Search with Suggestions</h1>

    <div class="search-container">
        <input type="text" id="nameSearch" placeholder="Search by Name, City or Pincode..." oninput="filterNameSuggestions()">
        <div id="nameSuggestions" class="suggestions"></div>
        <div id="nameError" class="error"></div> <!-- Error message for name search -->
    </div>

    <div class="search-container">
        <input type="text" id="machineSearch" placeholder="Search by machine..." oninput="filterMachineSuggestions()">
        <div id="machineSuggestions" class="suggestions"></div>
        <div id="machineError" class="error"></div> <!-- Error message for machine search -->
    </div>

    <button onclick="displayResults()">Submit</button>

    <div id="results"></div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        let csvData = [];
        let headers = [];

        // Load CSV data
        $(document).ready(function () {
            $.get('assets/mp4/client.csv', function (data) {
                const lines = data.trim().split('\n');
                headers = lines[0].split(',');

                for (let i = 1; i < lines.length; i++) {
                    const row = lines[i].split(',');
                    if (row.length >= headers.length) {
                        csvData.push(row);
                    }
                }
                console.log('CSV Data Loaded:', csvData);
            }).fail(function () {
                alert('Error loading CSV file.');
            });
        });

        // Filter and display name suggestions
        function filterNameSuggestions() {
            const input = document.getElementById('nameSearch').value.toLowerCase();
            const suggestionsDiv = document.getElementById('nameSuggestions');
            suggestionsDiv.innerHTML = '';
            suggestionsDiv.style.display = 'none';

            if (input) {
                const filteredData = csvData.filter(row =>
                    row.some(cell => cell && cell.toLowerCase().includes(input))
                );

                console.log('Filtered Name Data:', filteredData); // Debugging line

                const uniqueSuggestions = [...new Set(filteredData.flat())];

                uniqueSuggestions.forEach(suggestion => {
                    const div = document.createElement('div');
                    div.innerText = suggestion;
                    div.onclick = () => selectSuggestion('nameSearch', suggestion);
                    suggestionsDiv.appendChild(div);
                });

                if (uniqueSuggestions.length > 0) {
                    suggestionsDiv.style.display = 'block';
                }
            }
        }

        // Filter and display machine suggestions
        function filterMachineSuggestions() {
            const input = document.getElementById('machineSearch').value.toLowerCase();
            const suggestionsDiv = document.getElementById('machineSuggestions');
            suggestionsDiv.innerHTML = '';
            suggestionsDiv.style.display = 'none';

            if (input) {
                const filteredMachines = csvData.map(row => row[8]).filter(machine => machine && machine.toLowerCase().includes(input));
                const uniqueSuggestions = [...new Set(filteredMachines)];

                uniqueSuggestions.forEach(suggestion => {
                    const div = document.createElement('div');
                    div.innerText = suggestion;
                    div.onclick = () => selectSuggestion('machineSearch', suggestion);
                    suggestionsDiv.appendChild(div);
                });

                if (uniqueSuggestions.length > 0) {
                    suggestionsDiv.style.display = 'block';
                }
            }
        }

        function selectSuggestion(inputId, suggestion) {
            document.getElementById(inputId).value = suggestion;
            document.getElementById(inputId === 'nameSearch' ? 'nameSuggestions' : 'machineSuggestions').innerHTML = '';
            document.getElementById(inputId === 'nameSearch' ? 'nameSuggestions' : 'machineSuggestions').style.display = 'none';
        }

        function displayResults() {
            const name = document.getElementById('nameSearch').value.trim();
            const machine = document.getElementById('machineSearch').value.trim();
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';
            document.getElementById('nameError').innerText = ''; // Clear previous error message
            document.getElementById('machineError').innerText = ''; // Clear previous error message

            // Validation
            if (!name && !machine) {
                document.getElementById('nameError').innerText = 'Please enter a name or pincode to search.';
                document.getElementById('machineError').innerText = 'Please enter a machine to search.';
                return; // Exit the function if both fields are empty
            }

            // Check for invalid characters if needed (optional)
            const regex = /^[a-zA-Z0-9\s]+$/; // Only allow alphanumeric and spaces
            if (name && !regex.test(name)) {
                document.getElementById('nameError').innerText = 'Invalid characters in name search.';
                return;
            }
            if (machine && !regex.test(machine)) {
                document.getElementById('machineError').innerText = 'Invalid characters in machine search.';
                return;
            }

            const matchingRows = csvData.filter(row =>
                (name ? row.some(cell => cell && cell.toLowerCase().includes(name.toLowerCase())) : true) &&
                (machine ? row[8] && row[8].toLowerCase() === machine.toLowerCase() : true)
            );

            console.log('Matching Rows:', matchingRows); // Debugging line

            matchingRows.forEach(row => {
                const card = document.createElement('div');
                card.className = 'result-card';

                // Display the image
                const img = document.createElement('img');
                img.src = row[12]; // Image URL from row 12
                img.className = 'image'; // Add image class for full width

                card.appendChild(img); // Add image to card

                // Display other data, hiding contact and email headings and data
                headers.forEach((header, index) => {
                    if (index !== 7 && index !== 10 && index !== 11) { // Skip unwanted rows
                        const div = document.createElement('div');
                        div.className = 'result-row';

                        const headerDiv = document.createElement('span');
                        headerDiv.className = 'result-header';
                        headerDiv.innerText = header;
                        div.appendChild(headerDiv);

                        const contentDiv = document.createElement('span');
                        contentDiv.className = 'result-content';
                        contentDiv.innerText = row[index];
                        div.appendChild(contentDiv);

                        card.appendChild(div);
                    }
                });

                // Add icons for contact and email
                const iconsDiv = document.createElement('div');
                iconsDiv.className = 'icons';

                // Email Icon
                const emailIcon = document.createElement('a');
                emailIcon.href = `mailto:${row[9]}`; // Mail link from row 9
                emailIcon.target = '_blank'; // Open in new tab
                emailIcon.innerHTML = '<i class="fas fa-envelope icon"></i>'; // Font Awesome envelope icon
                iconsDiv.appendChild(emailIcon);

                // Website Icon
                const websiteIcon = document.createElement('a');
                websiteIcon.href = row[10]; // Website link from row 10
                websiteIcon.target = '_blank'; // Open in new tab
                websiteIcon.innerHTML = '<i class="fas fa-globe icon"></i>'; // Font Awesome globe icon
                iconsDiv.appendChild(websiteIcon);

                // Phone Icon
                const phoneIcon = document.createElement('a');
                phoneIcon.href = `tel:${row[8]}`; // Contact link from row 8
                phoneIcon.innerHTML = '<i class="fas fa-phone-alt icon"></i>'; // Font Awesome phone icon
                iconsDiv.appendChild(phoneIcon);

                card.appendChild(iconsDiv); // Add icons to card
                resultsDiv.appendChild(card);
            });
        }
    </script>
</body>
</html>
